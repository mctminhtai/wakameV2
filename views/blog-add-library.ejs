<%- contentFor('body') %>
    <div class="container" style="margin-top: 200px;">

        <div class="row">
            <h2 class="wow fadeInUp dropzone-title" >Please Upload Images</h2>
            <div id="dropzone" class="wow fadeInUp dropzone" ></div>
            <div class="button d-grid d-md-inline-block" >
                <button class="wow fadeInUp btn dropzone-next" onclick="submitUploadedFiles()">Next Step</button>
            </div>
        </div>

    </div>

<%- contentFor('stylesheet') %>
    <link rel="stylesheet" href="stylesheets/main.css">
    <link rel="stylesheet" href="stylesheets/dropzone.css">

<%- contentFor('customScript') %>
    <script src="javascripts/dropzone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <script>
        const uploadUrl = "/upload/photo";
        let imgList = [];
        Dropzone.autoDiscover = false;
        let myDropzone = new Dropzone("div#dropzone", { 
            url: uploadUrl ,
            paramName: "file", // The name that will be used to transfer the file
            maxFilesize: 10, // MB
            parallelUploads: 4,
            thumbnailWidth:'300',
            thumbnailHeight:'300',
            resizeWidth: null,
            resizeHeight: null,
            resizeMimeType: null,
            autoProcessQueue: true, //auto upload to server or upload when click some button
            resizeQuality: 1,
            resizeMethod: 'contain',
            maxFiles: null,
            acceptedFiles: 'image/*',//image/*,application/pdf,.psd
            previewsContainer: null,
            addRemoveLinks: true,
        });
        myDropzone.on("removedfile",(file)=>{
            const response = JSON.parse(file.xhr.response);
            let deleteUrl = uploadUrl + '/' + response.ObjectId;
            imgList.splice(imgList.indexOf(response.ObjectId),1);
            console.log(imgList);
            axios.delete(deleteUrl);
        });
        myDropzone.on("success",(file)=>{
            console.log(file);
            const response = JSON.parse(file.xhr.response);
            imgList.push(response.ObjectId);
            console.log(imgList);
        });
        
        function submitUploadedFiles(){
            axios.post(location.pathname,{imgList}).then((response)=>{console.log(response)}).catch((error)=>{console.log(error)});
        }
    </script>